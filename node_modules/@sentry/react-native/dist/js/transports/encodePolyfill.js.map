{"version":3,"file":"encodePolyfill.js","sourceRoot":"","sources":["../../../src/js/transports/encodePolyfill.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,gBAAgB,EAAE,MAAM,kBAAkB,CAAC;AACpD,OAAO,EAAE,aAAa,EAAE,MAAM,oBAAoB,CAAC;AACnD,OAAO,EAAE,WAAW,EAAE,MAAM,WAAW,CAAC;AAExC,MAAM,CAAC,MAAM,iBAAiB,GAAG,GAAS,EAAE;IAC1C,MAAM,OAAO,GAAG,gBAAgB,EAAE,CAAC;IAEnC,IAAI,aAAa,CAAC,WAAW,EAAE;QAC7B,2DAA2D;QAC3D,qFAAqF;QACrF,OAAO,CAAC,cAAc,GAAG,mBAAmB,CAAC,aAAa,CAAC,WAAW,CAAC,CAAC;KACzE;SAAM;QACL,OAAO,CAAC,cAAc,GAAG,cAAc,CAAC;KACzC;AACH,CAAC,CAAC;AAEF;;;GAGG;AACH,MAAM,CAAC,MAAM,mBAAmB,GAAG,CAAC,OAAqB,EAAE,EAAE,CAAC,CAAC,IAAY,EAAE,EAAE,CAAC,IAAI,OAAO,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;AAI3G;;GAEG;AACH,MAAM,CAAC,MAAM,cAAc,GAAG,CAAC,IAAY,EAAc,EAAE;IACzD,MAAM,KAAK,GAAG,IAAI,UAAU,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC,CAAC;IAChD,OAAO,KAAK,CAAC;AACf,CAAC,CAAC","sourcesContent":["import { getSentryCarrier } from '../utils/carrier';\nimport { RN_GLOBAL_OBJ } from '../utils/worldwide';\nimport { utf8ToBytes } from '../vendor';\n\nexport const useEncodePolyfill = (): void => {\n  const carrier = getSentryCarrier();\n\n  if (RN_GLOBAL_OBJ.TextEncoder) {\n    // Hermes for RN 0.74 and later includes native TextEncoder\n    // https://github.com/facebook/hermes/commit/8fb0496d426a8e50d00385148d5fb498a6daa312\n    carrier.encodePolyfill = globalEncodeFactory(RN_GLOBAL_OBJ.TextEncoder);\n  } else {\n    carrier.encodePolyfill = encodePolyfill;\n  }\n};\n\n/*\n * The default encode polyfill is available in Hermes for RN 0.74 and later.\n * https://github.com/facebook/hermes/commit/8fb0496d426a8e50d00385148d5fb498a6daa312\n */\nexport const globalEncodeFactory = (Encoder: EncoderClass) => (text: string) => new Encoder().encode(text);\n\ntype EncoderClass = Required<typeof RN_GLOBAL_OBJ>['TextEncoder'];\n\n/*\n * Encode polyfill runs in JS and might cause performance issues when processing large payloads. (~2+ MB)\n */\nexport const encodePolyfill = (text: string): Uint8Array => {\n  const bytes = new Uint8Array(utf8ToBytes(text));\n  return bytes;\n};\n"]}